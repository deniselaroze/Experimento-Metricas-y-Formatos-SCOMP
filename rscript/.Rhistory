coord_cartesian(ylim=c(min,max))  #coord_flip() +
return(ggsave(paste0(path, "TreatV", v, QID ,".png"), width=30, height = 30, units = "cm"))
}
#fcn.treat4("F", "nivel4", "2a", "co_2arp" )
##################################
###### Generating treatments
##################################
# Manual treatment generation, for testing
#QID<-"qualtricsID"
fcn.treat3("M", "nivel4", "rp", "co_1brp", 10 )
QID<-"qualtricsID"
fcn.treat3("M", "nivel4", "rp", "co_1brp", 10 )
id<-paste0(gender, econ, ".", mode, ".", pair)
id<-paste0(gender, econ, ".", pairvct[2], ".", pair)
payment<-all.files[all.files$id==id, c("razon_social" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
payment
payment$opcion<-1:15
payment$VPN<-ifelse(is.na(payment$VPN), 0, payment$VPN )
n <- 15
payment
fcn.control("F", "nivel4", "rp", "co_2arp", 1 )
fcn.treat1("F", "nivel4", "rp", "co_2arp", 2 )
fcn.treat2("F", "nivel4", "rp", "co_2arp", 3 )
fcn.treat3("M", "nivel4", "rp", "co_2arp", 4)
selectedTreat<-"Control"
namedVF<-list(control=fcn.control, treat1=fcn.treat1, treat2=fcn.treat2, treat3=fcn.treat3, treat4=fcn.treat4  )
payment<-ifelse(selectedTreat=="control", payment[order(-payment$val_uf_pension),] ,
ifelse(selectedTreat=="treat1", payment[order(-payment$val_peso_pension),]  ,
ifelse(selectedTreat=="treat2", payment[order(-payment$val_peso_pension),]  ,
ifelse(selectedTreat=="treat3", payment[order(-payment$VPN) ,],
payment[order(-payment$VPN),]
))))
View(payment)
id<-paste0(gender, econ, ".", pairvct[2], ".", pair)
payment<-all.files[all.files$id==id, c("razon_social" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
payment$opcion<-1:15
payment$VPN<-ifelse(is.na(payment$VPN), 0, payment$VPN )
View(payment)
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
mode<-pairvct[2]
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
View(payment)
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_peso_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
names(all.files)
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
View(payment)
# treatment if condition for payment$opcion  order
payment<-ifelse(selectedTreat=="control", payment[order(-payment$val_uf_pension),] ,
ifelse(selectedTreat=="treat1", payment[order(-payment$val_pesos_pension),]  ,
ifelse(selectedTreat=="treat2", payment[order(-payment$val_pesos_pension),]  ,
ifelse(selectedTreat=="treat3", payment[order(-payment$VPN) ,],
payment[order(-payment$VPN),]
))))
View(payment)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
# treatment if condition for payment$opcion  order
payment<-ifelse(selectedTreat=="control", payment[order(-payment$val_uf_pension),] , payment[order(-payment$VPN),])
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
# treatment if condition for payment$opcion  order
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]} else {payment[order(-payment$VPN),]}
View(payment)
selectedTreat<-"treat4"
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
# treatment if condition for payment$opcion  order
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]}
else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]}
else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]}
else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]}
else {payment[order(-payment$VPN),]}
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]}
if else (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]}
if else (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]}
#else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]}
else {payment[order(-payment$VPN),]}
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]} ,
else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]},
else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]},
else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]},
else {payment[order(-payment$VPN),]}
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]}
else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]}
else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]}
else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]}
else {payment[order(-payment$VPN),]}
payment<-ifelse(selectedTreat=="control", payment[order(-payment$val_uf_pension),], payment[order(-payment$VPN),] )
ifelse(selectedTreat=="control", payment<- payment[order(-payment$val_uf_pension),], payment<- payment[order(-payment$VPN),] )
if(selectedTreat=="control") { payment<-payment[order(-payment$val_uf_pension),]}
else if (selectedTreat=="treat1") { payment<- payment[order(-payment$val_pesos_pension),]}
else if (selectedTreat=="treat2") {  payment<-payment[order(-payment$val_pesos_pension),]}
else if (selectedTreat=="treat3") {  payment<-payment[order(-payment$VPN),]}
else { payment<-payment[order(-payment$VPN),]}
if(selectedTreat=="control") { payment<-payment[order(-payment$val_uf_pension),]}
else  { payment<- payment[order(-payment$val_pesos_pension),]}
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]}
#else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]}
#else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]}
#else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]}
else {payment[order(-payment$VPN),]}
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
# treatment if condition for payment$opcion  order
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]}
#else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]}
#else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]}
#else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]}
else {payment[order(-payment$VPN),]}
payment<-if(selectedTreat=="control") {order(-payment$val_uf_pension)}
#else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]}
#else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]}
#else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]}
else {order(-payment$VPN)}
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
payment<-payment[order(-payment$val_uf_pension),]
payment<-payment[order(-payment$VPN),]
payment<-ifelse(selectedTreat=="control", payment[order(-payment$val_uf_pension),] , payment[order(-payment$VPN),])
View(payment)
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
selectedTreat<-"treat4"
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]} else {payment[order(-payment$VPN),]}
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]
} else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]
} else {payment[order(-payment$VPN),]}
fcn.payment <- function(gender, econ, mode, pair, selectedTreat){
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
# treatment if condition for payment$opcion  order
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]
} else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]
} else {payment[order(-payment$VPN),]}
payment$opcion<-1:15
payment$VPN<-ifelse(is.na(payment$VPN), 0, payment$VPN )
n <- 15
payment$pay<- ifelse(payment$VPN==0, 0,
ifelse(payment$VPN==max(payment$VPN, na.rm=T), 1500,
ifelse(payment$VPN==sort(payment$VPN,partial=n-1)[n-1], 1400,
ifelse(payment$VPN==sort(payment$VPN,partial=n-2)[n-2], 1200,
ifelse(payment$VPN==sort(payment$VPN,partial=n-3)[n-3], 900,
ifelse(payment$VPN==sort(payment$VPN,partial=n-4)[n-4], 500,
ifelse(payment$VPN==sort(payment$VPN,partial=n-5)[n-5], 100,
ifelse(payment$VPN==sort(payment$VPN,partial=n-6)[n-6], 50, 0
) ) ) ) ) ) ) )
row.names(payment)<-payment$opcion
pay.list<-payment[, "pay"]
pay.list <- as.list(as.data.frame(t(pay.list)))
return(pay.list)
}
pay.op1<-fcn.payment(gender, econ, pairvct[1], pair, selected[[1]])
tr<-c(1, 5)
namedVF<-list(control=fcn.control, treat1=fcn.treat1, treat2=fcn.treat2, treat3=fcn.treat3, treat4=fcn.treat4  )
#namedVF<-list(control=fcn.treat4, treat1=fcn.treat4, treat2=fcn.treat4, treat3=fcn.treat4, treat4=fcn.treat4 )
#### Random selection of treatment without replacement
selected<-c(namedVF[tr[1]],namedVF[tr[2]])
selectedQID<-names(selected) ## list of selected treatments to send to Qualtrics
selected[[1]](gender, econ, pairvct[1], pair, v=1)
selected[[2]](gender, econ, pairvct[2], pair, v=2)
View(pay.op1)
View(pay.op2)
pay.op1<-fcn.payment(gender, econ, pairvct[1], pair, selected[[1]])
pay.op2<-fcn.payment(gender, econ, pairvct[2], pair, selected[[2]])
selected
pay.op1<-fcn.payment(gender, econ, pairvct[1], pair, selectedQID[1])
pay.op2<-fcn.payment(gender, econ, pairvct[2], pair, selectedQID[2])
View(pay.op1)
View(pay.op2)
View(pay.op1)
View(pay.op2)
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
# treatment if condition for payment$opcion  order
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]
} else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]
} else {payment[order(-payment$VPN),]}
payment$opcion<-1:15
View(payment)
payment$VPN<-ifelse(is.na(payment$VPN), 0, payment$VPN )
View(payment)
n <- 15
payment$pay<- ifelse(payment$VPN==0, 0,
ifelse(payment$VPN==max(payment$VPN, na.rm=T), 1500,
ifelse(payment$VPN==sort(payment$VPN,partial=n-1)[n-1], 1400,
ifelse(payment$VPN==sort(payment$VPN,partial=n-2)[n-2], 1200,
ifelse(payment$VPN==sort(payment$VPN,partial=n-3)[n-3], 900,
ifelse(payment$VPN==sort(payment$VPN,partial=n-4)[n-4], 500,
ifelse(payment$VPN==sort(payment$VPN,partial=n-5)[n-5], 100,
ifelse(payment$VPN==sort(payment$VPN,partial=n-6)[n-6], 50, 0
) ) ) ) ) ) ) )
View(payment)
row.names(payment)<-payment$opcion
View(payment)
pay.list<-payment[, "pay"]
pay.list
pay.list <- as.list(as.data.frame(t(pay.list)))
pay.list
fcn.payment <- function(gender, econ, mode, pair, selectedTreat){
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
# treatment if condition for payment$opcion  order
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]
} else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]
} else {payment[order(-payment$VPN),]}
payment$opcion<-1:15
payment$VPN<-ifelse(is.na(payment$VPN), 0, payment$VPN )
n <- 15
payment$pay<- ifelse(payment$VPN==0, 0,
ifelse(payment$VPN==max(payment$VPN, na.rm=T), 1500,
ifelse(payment$VPN==sort(payment$VPN,partial=n-1)[n-1], 1400,
ifelse(payment$VPN==sort(payment$VPN,partial=n-2)[n-2], 1200,
ifelse(payment$VPN==sort(payment$VPN,partial=n-3)[n-3], 900,
ifelse(payment$VPN==sort(payment$VPN,partial=n-4)[n-4], 500,
ifelse(payment$VPN==sort(payment$VPN,partial=n-5)[n-5], 100,
ifelse(payment$VPN==sort(payment$VPN,partial=n-6)[n-6], 50, 0
) ) ) ) ) ) ) )
row.names(payment)<-payment$opcion
pay.list<-payment[, "pay"]
pay.list <- as.list(as.data.frame(t(pay.list)))
return(pay.list)
}
pairvct
pay.op1<-fcn.payment(gender, econ, pairvct[1], pair, selectedQID[1])
pay.op1
pay.op2<-fcn.payment(gender, econ, pairvct[2], pair, selectedQID[2])
pay.op2
gender<-"F"
tr<-C(2,4)
tr<-c(2,4)
namedVF<-list(control=fcn.control, treat1=fcn.treat1, treat2=fcn.treat2, treat3=fcn.treat3, treat4=fcn.treat4  )
#namedVF<-list(control=fcn.treat4, treat1=fcn.treat4, treat2=fcn.treat4, treat3=fcn.treat4, treat4=fcn.treat4 )
#### Random selection of treatment without replacement
selected<-c(namedVF[tr[1]],namedVF[tr[2]])
selectedQID<-names(selected) ## list of selected treatments to send to Qualtrics
### executing treatments
selected[[1]](gender, econ, pairvct[1], pair, v=1)
selected[[2]](gender, econ, pairvct[2], pair, v=2)
fcn.payment <- function(gender, econ, mode, pair, selectedTreat){
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
# treatment if condition for payment$opcion  order
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]
} else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]
} else {payment[order(-payment$VPN),]}
payment$opcion<-1:15
payment$VPN<-ifelse(is.na(payment$VPN), 0, payment$VPN )
n <- 15
payment$pay<- ifelse(payment$VPN==0, 0,
ifelse(payment$VPN==max(payment$VPN, na.rm=T), 1500,
ifelse(payment$VPN==sort(payment$VPN,partial=n-1)[n-1], 1400,
ifelse(payment$VPN==sort(payment$VPN,partial=n-2)[n-2], 1200,
ifelse(payment$VPN==sort(payment$VPN,partial=n-3)[n-3], 900,
ifelse(payment$VPN==sort(payment$VPN,partial=n-4)[n-4], 500,
ifelse(payment$VPN==sort(payment$VPN,partial=n-5)[n-5], 100,
ifelse(payment$VPN==sort(payment$VPN,partial=n-6)[n-6], 50, 0
) ) ) ) ) ) ) )
row.names(payment)<-payment$opcion
pay.list<-payment[, "pay"]
pay.list <- as.list(as.data.frame(t(pay.list)))
return(pay.list)
}
pay.op1<-fcn.payment(gender, econ, pairvct[1], pair, selectedQID[1])
pay.op2<-fcn.payment(gender, econ, pairvct[2], pair, selectedQID[2])
pay.op1
tr<-(1,4)
tr<-c(1,4)
selected<-c(namedVF[tr[1]],namedVF[tr[2]])
selectedQID<-names(selected) ## list of selected treatments to send to Qualtrics
### executing treatments
selected[[1]](gender, econ, pairvct[1], pair, v=1)
selected[[2]](gender, econ, pairvct[2], pair, v=2)
#
mode1Q<-2
mode2Q<-2
gender<-if(genderQ=="1") "M" else "F"
econ<- if(mode1Q=="1") {"nivel1"
} else if(mode1Q=="2")  {"nivel2"
} else if(mode1Q=="3")  { "nivel3" } else {"nivel4"}
pg<- if(pgQ=="1") "a" else "b"
mode1<-if(mode1Q=="1") {"rp"
} else if(mode1Q=="2")  {
"1"
} else if(mode1Q=="3")  {
"2"} else {"3"}
mode2<-if(mode2Q=="1") {"rp"
} else if(mode2Q=="2")  {
"1"
} else if(mode2Q =="3")  {
"2"} else {"3"}
mode1pg<- if (grepl("rp", mode1)) mode1 else paste0(mode1,pg)
mode2pg<- if (grepl("rp", mode2)) mode2 else paste0(mode2,pg)
pairvct<-c(mode1pg, mode2pg)
#pairvct
pairvct<-sort(pairvct)
#pairvct
pair<-paste0("co_", pairvct[1], pairvct[2])
#QID<-"654987987" # to be replaced by a real Qualtrics ID code, unique to each participant
#### list of treatment functions
#
namedVF<-list(control=fcn.control, treat1=fcn.treat1, treat2=fcn.treat2, treat3=fcn.treat3, treat4=fcn.treat4  )
#namedVF<-list(control=fcn.treat4, treat1=fcn.treat4, treat2=fcn.treat4, treat3=fcn.treat4, treat4=fcn.treat4 )
#### Random selection of treatment without replacement
selected<-c(namedVF[tr[1]],namedVF[tr[2]])
selectedQID<-names(selected) ## list of selected trea
selected[[1]](gender, econ, pairvct[1], pair, v=1)
selected[[2]](gender, econ, pairvct[2], pair, v=2)
mode2Q<-3
gender<-if(genderQ=="1") "M" else "F"
econ<- if(mode1Q=="1") {"nivel1"
} else if(mode1Q=="2")  {"nivel2"
} else if(mode1Q=="3")  { "nivel3" } else {"nivel4"}
pg<- if(pgQ=="1") "a" else "b"
mode1<-if(mode1Q=="1") {"rp"
} else if(mode1Q=="2")  {
"1"
} else if(mode1Q=="3")  {
"2"} else {"3"}
mode2<-if(mode2Q=="1") {"rp"
} else if(mode2Q=="2")  {
"1"
} else if(mode2Q =="3")  {
"2"} else {"3"}
mode1pg<- if (grepl("rp", mode1)) mode1 else paste0(mode1,pg)
mode2pg<- if (grepl("rp", mode2)) mode2 else paste0(mode2,pg)
pairvct<-c(mode1pg, mode2pg)
#pairvct
pairvct<-sort(pairvct)
#pairvct
pair<-paste0("co_", pairvct[1], pairvct[2])
#QID<-"654987987" # to be replaced by a real Qualtrics ID code, unique to each participant
#### list of treatment functions
#
namedVF<-list(control=fcn.control, treat1=fcn.treat1, treat2=fcn.treat2, treat3=fcn.treat3, treat4=fcn.treat4  )
#namedVF<-list(control=fcn.treat4, treat1=fcn.treat4, treat2=fcn.treat4, treat3=fcn.treat4, treat4=fcn.treat4 )
#### Random selection of treatment without replacement
selected<-c(namedVF[tr[1]],namedVF[tr[2]])
selectedQID<-names(selected) ## list of selected treatments to send to Qualtrics
### executing treatments
selected[[1]](gender, econ, pairvct[1], pair, v=1)
selected[[2]](gender, econ, pairvct[2], pair, v=2)
fcn.payment <- function(gender, econ, mode, pair, selectedTreat){
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
# treatment if condition for payment$opcion  order
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]
} else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]
} else {payment[order(-payment$VPN),]}
payment$opcion<-1:15
payment$VPN<-ifelse(is.na(payment$VPN), 0, payment$VPN )
n <- 15
payment$pay<- ifelse(payment$VPN==0, 0,
ifelse(payment$VPN==max(payment$VPN, na.rm=T), 1500,
ifelse(payment$VPN==sort(payment$VPN,partial=n-1)[n-1], 1400,
ifelse(payment$VPN==sort(payment$VPN,partial=n-2)[n-2], 1200,
ifelse(payment$VPN==sort(payment$VPN,partial=n-3)[n-3], 900,
ifelse(payment$VPN==sort(payment$VPN,partial=n-4)[n-4], 500,
ifelse(payment$VPN==sort(payment$VPN,partial=n-5)[n-5], 100,
ifelse(payment$VPN==sort(payment$VPN,partial=n-6)[n-6], 50, 0
) ) ) ) ) ) ) )
row.names(payment)<-payment$opcion
pay.list<-payment[, "pay"]
pay.list <- as.list(as.data.frame(t(pay.list)))
return(pay.list)
}
pay.op1<-fcn.payment(gender, econ, pairvct[1], pair, selectedQID[1])
pay.op1
pay.op2<-fcn.payment(gender, econ, pairvct[2], pair, selectedQID[2])
pay.op2
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "VPN")]
length<-length(tbl)
length
View(tbl)
fcn.opcion <- function(gender, econ, mode, pair, selectedTreat){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "VPN")]
length<-nrow(tbl)
return(length)
}
length1<-fcn.opcion(gender, econ, pairvct[1], pair)
length2<-fcn.opcion(gender, econ, pairvct[2], pair)
pairvct<-c(1,3)
length1<-fcn.opcion(gender, econ, pairvct[1], pair)
length2<-fcn.opcion(gender, econ, pairvct[2], pair)
length1
mode1Q<-1
mode2Q<-3
### Adaptation from Qualtrics to R
gender<-if(genderQ=="1") "M" else "F"
econ<- if(mode1Q=="1") {"nivel1"
} else if(mode1Q=="2")  {"nivel2"
} else if(mode1Q=="3")  { "nivel3" } else {"nivel4"}
pg<- if(pgQ=="1") "a" else "b"
mode1<-if(mode1Q=="1") {"rp"
} else if(mode1Q=="2")  {
"1"
} else if(mode1Q=="3")  {
"2"} else {"3"}
mode2<-if(mode2Q=="1") {"rp"
} else if(mode2Q=="2")  {
"1"
} else if(mode2Q =="3")  {
"2"} else {"3"}
mode1pg<- if (grepl("rp", mode1)) mode1 else paste0(mode1,pg)
mode2pg<- if (grepl("rp", mode2)) mode2 else paste0(mode2,pg)
pairvct<-c(mode1pg, mode2pg)
#pairvct
pairvct<-sort(pairvct)
#pairvct
pair<-paste0("co_", pairvct[1], pairvct[2])
#QID<-"654987987" # to be replaced by a real Qualtrics ID code, unique to each participant
#### list of treatment functions
#
namedVF<-list(control=fcn.control, treat1=fcn.treat1, treat2=fcn.treat2, treat3=fcn.treat3, treat4=fcn.treat4  )
#namedVF<-list(control=fcn.treat4, treat1=fcn.treat4, treat2=fcn.treat4, treat3=fcn.treat4, treat4=fcn.treat4 )
#### Random selection of treatment without replacement
selected<-c(namedVF[tr[1]],namedVF[tr[2]])
selectedQID<-names(selected) ## list of selected treatments to send to Qualtrics
### executing treatments
selected[[1]](gender, econ, pairvct[1], pair, v=1)
selected[[2]](gender, econ, pairvct[2], pair, v=2)
#### Payment lists for treatments
fcn.payment <- function(gender, econ, mode, pair, selectedTreat){
id<-paste0(gender, econ, ".", mode, ".", pair)
payment<-all.files[all.files$id==id, c("razon_social", "val_uf_pension", "val_pesos_pension" ,"VPN")]
mn<-15-nrow(payment)
payment[nrow(payment)+mn,] <- NA
# treatment if condition for payment$opcion  order
payment<-if(selectedTreat=="control") {payment[order(-payment$val_uf_pension),]
} else if (selectedTreat=="treat1") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat2") { payment[order(-payment$val_pesos_pension),]
} else if (selectedTreat=="treat3") { payment[order(-payment$VPN),]
} else {payment[order(-payment$VPN),]}
payment$opcion<-1:15
payment$VPN<-ifelse(is.na(payment$VPN), 0, payment$VPN )
n <- 15
payment$pay<- ifelse(payment$VPN==0, 0,
ifelse(payment$VPN==max(payment$VPN, na.rm=T), 1500,
ifelse(payment$VPN==sort(payment$VPN,partial=n-1)[n-1], 1400,
ifelse(payment$VPN==sort(payment$VPN,partial=n-2)[n-2], 1200,
ifelse(payment$VPN==sort(payment$VPN,partial=n-3)[n-3], 900,
ifelse(payment$VPN==sort(payment$VPN,partial=n-4)[n-4], 500,
ifelse(payment$VPN==sort(payment$VPN,partial=n-5)[n-5], 100,
ifelse(payment$VPN==sort(payment$VPN,partial=n-6)[n-6], 50, 0
) ) ) ) ) ) ) )
row.names(payment)<-payment$opcion
pay.list<-payment[, "pay"]
pay.list <- as.list(as.data.frame(t(pay.list)))
return(pay.list)
}
pay.op1<-fcn.payment(gender, econ, pairvct[1], pair, selectedQID[1])
pay.op2<-fcn.payment(gender, econ, pairvct[2], pair, selectedQID[2])
### Largo Opciones por tratamiento
fcn.opcion <- function(gender, econ, mode, pair, selectedTreat){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "VPN")]
length<-nrow(tbl)
return(length)
}
length1<-fcn.opcion(gender, econ, pairvct[1], pair)
length2<-fcn.opcion(gender, econ, pairvct[2], pair)
length1
length2
