tbl$VPNDiff<- tbl$VPN - max(tbl$VPN)
tbl$val_pesos_pension_bru<-round( tbl$val_pesos_pension_bru, 0)
tbl$VPNDiff<-round( tbl$VPNDiff, 0)
names(tbl)<-c( "Razón Social", "Valor Pensión $",  "Total VPN Pensión", "VPN dif")
tbl<-xtable(tbl, caption="Leyenda del Tratamiento 3" )
digits(tbl) <- c(0,0,0,0,0)
return(print(tbl, type="HTML", file=paste0("Tratamientos/Treat3", id ,".html"), include.rownames=FALSE,
format.args=list(big.mark = ".", decimal.mark = ","))
)
}
##########################
### Function - Treatment 4 // Simulation code, this still needs to be adjusted and tested using real data
##########################
fcn.treat4 <- function(gender, econ, mode, pair){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "val_pesos_pension_bru", "VPN")]
tbl$val_pesos_pension_bru<-round( tbl$val_pesos_pension_bru, 0)
n<-nrow(tbl)
tbl$Company <- factor(tbl$razon_social, levels = tbl$razon_social[rev(order(tbl$VPN))])
max<-max(tbl$VPN, na.rm=T)+1500000
min<-min(tbl$VPN, na.rm=T)-1000000
point <- format_format(big.mark = ".", decimal.mark = ",", scientific = FALSE)
options(scipen=1000)
p<-ggplot(data=tbl, aes(x=Company, y=VPN, fill = Company)) +
geom_bar(stat="identity") +
#geom_text(aes(label=VPE_mensual, vjust=-0.8)) +
scale_fill_manual(values= rev(colorRampPalette(brewer.pal(11, "RdYlGn"))(n))) +
theme(legend.position="") +
scale_y_continuous(labels=function(x) format(x, big.mark = ".",decimal.mark=",",
scientific = FALSE)#,
#                    sec.axis = sec_axis(~./240, name = "Pensión Mensual (pesos)", labels=function(x) format(x, big.mark = ".", decimal.mark = ",", scientific = FALSE))
)+
ylab("Total Valor Económico Pensión")  + xlab("")  +
theme(axis.text.y=element_text(size=rel(1.4) , angle=90),
axis.title.y=element_text(size=rel(1.8) ),
axis.text.x=element_text(size=rel(1.4), angle=90),
panel.grid.major.x = element_blank(),
panel.grid.major.y = element_line(colour = "Grey30", linetype = "dashed"))+
geom_text(aes(label = paste0("$",point(val_pesos_pension_bru)) , angle=90, size = 2, vjust = 0.4, hjust= -0.1)) +
coord_cartesian(ylim=c(min,max))  #coord_flip() +
return(ggsave(paste0("Tratamientos/Treat4", id ,".png"), width=30, height = 25, units = "cm"))
}
gender<-"F"
income<-"nivel2"
modes<- "1"
pg<-"b"
match<-"co_2a3a"
gender<-"F"
income<-"nivel2"
mode1<- "1"
mode2<- "3"
pg<-"b"
match<-paste0("co_", mode1, pg, mode2, pg)
View(all.files)
all.files$perfil2<-substr(all.files$perfil, start = 1, stop = 2)
View(all.files)
unique(all.files$perfil)
perfil.files <- list.files("./CSV/", recursive = T, pattern = 'co_.+csv', full.names = T)
##Leer Columnas
all.files <- NULL
for(bf in perfil.files){
temp <- read.csv2(bf, as.is = T)
valid_col <- ncol(temp)-3
for(i in 1:valid_col)temp[ , i] <- gsub("\\s","", temp[, i])
df <- sub(".+/CSV/", "\\1", bf)
df<-file_path_sans_ext(df)
temp$pid <- df
all.files <- rbind.fill(all.files, temp)
}
table(table(all.files$perfil))
all.files$perfil2<-substr(all.files$perfil, start = 1, stop = 2)
unique(all.files$perfil)
rm(list = ls())
###########################################
### Creando un sólo DF con todas los datos
###########################################
## Leer nombre de archivos
perfil.files <- list.files("./CSV/", recursive = T, pattern = 'co_.+csv', full.names = T)
##Leer Columnas
all.files <- NULL
for(bf in perfil.files){
temp <- read.csv2(bf, as.is = T)
valid_col <- ncol(temp)-3
for(i in 1:valid_col)temp[ , i] <- gsub("\\s","", temp[, i])
df <- sub(".+/CSV/", "\\1", bf)
df<-file_path_sans_ext(df)
temp$pid <- df
all.files <- rbind.fill(all.files, temp)
}
table(table(all.files$perfil))
unique(all.files$perfil)
setwd("~/GitHub/Experimento-Metricas-y-Formatos-SCOMP/Excel_SP")
rm(list = ls())
###########################################
### Creando un sólo DF con todas los datos
###########################################
## Leer nombre de archivos
perfil.files <- list.files("./CSV/", recursive = T, pattern = 'co_.+csv', full.names = T)
##Leer Columnas
all.files <- NULL
for(bf in perfil.files){
temp <- read.csv2(bf, as.is = T)
valid_col <- ncol(temp)-3
for(i in 1:valid_col)temp[ , i] <- gsub("\\s","", temp[, i])
df <- sub(".+/CSV/", "\\1", bf)
df<-file_path_sans_ext(df)
temp$pid <- df
all.files <- rbind.fill(all.files, temp)
}
table(table(all.files$perfil))
unique(all.files$perfil)
all.files$perfil2<-substr(all.files$perfil, start = 1, stop = 2)
##Agrego ID Unico = Grupo + Perfil
all.files <- cbind(id = paste0( all.files$grupo,".", all.files$perfil,".", all.files$pid),all.files )
##Cambio ID a variable Categorica, para hacer pruebas
all.files$nid<-as.numeric(all.files$id)
table(all.files$nid)
unique(all.files$perfil)
unique(all.files$perfil2)
all.files <- cbind(id = paste0( all.files$grupo,".", all.files$perfil2,".", all.files$pid),all.files )
rm(list = ls())
###########################################
### Creando un sólo DF con todas los datos
###########################################
## Leer nombre de archivos
perfil.files <- list.files("./CSV/", recursive = T, pattern = 'co_.+csv', full.names = T)
##Leer Columnas
all.files <- NULL
for(bf in perfil.files){
temp <- read.csv2(bf, as.is = T)
valid_col <- ncol(temp)-3
for(i in 1:valid_col)temp[ , i] <- gsub("\\s","", temp[, i])
df <- sub(".+/CSV/", "\\1", bf)
df<-file_path_sans_ext(df)
temp$pid <- df
all.files <- rbind.fill(all.files, temp)
}
table(table(all.files$perfil))
unique(all.files$perfil)
all.files$perfil2<-substr(all.files$perfil, start = 1, stop = 2)
unique(all.files$perfil2)
View(all.files)
all.files$id <- paste0( all.files$grupo,".", all.files$perfil2,".", all.files$pid)
View(all.files)
##Cambio ID a variable Categorica, para hacer pruebas
all.files$nid<-as.numeric(all.files$id)
table(all.files$nid)
## Transformación de pensión en pesos (valor UF 27.161,48 01/07/2018)
all.files$val_uf_pension_bru<-as.numeric(all.files$val_uf_pension_bru) #make numeric
all.files$val_pesos_pension_bru<-all.files$val_uf_pension_bru*27161.48
## Genero nuevo archivo con los cambios
write.table(all.files, "nuevaBD.csv", sep = ";", quote = F, row.names = T)
#################### End merge #####################################
all.files <- read.csv2("nuevaBD.csv", as.is = T)
fcn.control <- function(gender, econ, mode, pair){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "val_uf_pension_bru", "riesgo")]
names(tbl)<-c( "Razón Social", "Valor Pensión UF", "Clasificación de Riesgo")
tbl<-xtable(tbl, caption="Leyenda del Control" )
return(print(tbl, type="HTML", file=paste0("Tratamientos/control", id ,".html"), include.rownames=FALSE,
format.args=list(big.mark = ".", decimal.mark = ","))
)
}
fcn.control <- function(gender, econ, mode, pair){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "val_uf_pension_bru", "riesgo")]
names(tbl)<-c( "Razón Social", "Valor Pensión UF", "Clasificación de Riesgo")
tbl<-xtable(tbl, caption="Leyenda del Control" )
return(print(tbl, type="HTML", file=paste0("Tratamientos/control", id ,".html"), include.rownames=FALSE,
format.args=list(big.mark = ".", decimal.mark = ","))
)
}
##########################
### Function - Treatment 1
##########################
fcn.treat1 <- function(gender, econ, mode, pair){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "val_pesos_pension_bru", "riesgo")]
tbl$val_pesos_pension_bru<-round( tbl$val_pesos_pension_bru, 0)
names(tbl)<-c( "Razón Social", "Valor Pensión $", "Clasificación de Riesgo")
tbl<-xtable(tbl, caption="Leyenda del Tratamiento 1" )
digits(tbl) <- c(0,0,0,0)
return(print(tbl, type="HTML", file=paste0("Tratamientos/Treat1", id ,".html"), include.rownames=FALSE,
format.args=list(big.mark = ".", decimal.mark = ","))
)
}
##########################
### Function - Treatment 2
##########################
fcn.treat2 <- function(gender, econ, mode, pair){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "val_pesos_pension_bru", "VPN")]
tbl$val_pesos_pension_bru<-round( tbl$val_pesos_pension_bru, 0)
names(tbl)<-c( "Razón Social", "Valor Pensión $",  "Total VPN Pensión")
tbl<-xtable(tbl, caption="Leyenda del Tratamiento 2" )
digits(tbl) <- c(0,0,0,0)
return(print(tbl, type="HTML", file=paste0("Tratamientos/Treat2", id ,".html"), include.rownames=FALSE,
format.args=list(big.mark = ".", decimal.mark = ","))
)
}
##########################
### Function - Treatment 3
##########################
fcn.treat3 <- function(gender, econ, mode, pair){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "val_pesos_pension_bru", "VPN")]
tbl$VPNDiff<- tbl$VPN - max(tbl$VPN)
tbl$val_pesos_pension_bru<-round( tbl$val_pesos_pension_bru, 0)
tbl$VPNDiff<-round( tbl$VPNDiff, 0)
names(tbl)<-c( "Razón Social", "Valor Pensión $",  "Total VPN Pensión", "VPN dif")
tbl<-xtable(tbl, caption="Leyenda del Tratamiento 3" )
digits(tbl) <- c(0,0,0,0,0)
return(print(tbl, type="HTML", file=paste0("Tratamientos/Treat3", id ,".html"), include.rownames=FALSE,
format.args=list(big.mark = ".", decimal.mark = ","))
)
}
##########################
### Function - Treatment 4 // Simulation code, this still needs to be adjusted and tested using real data
##########################
fcn.treat4 <- function(gender, econ, mode, pair){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "val_pesos_pension_bru", "VPN")]
tbl$val_pesos_pension_bru<-round( tbl$val_pesos_pension_bru, 0)
n<-nrow(tbl)
tbl$Company <- factor(tbl$razon_social, levels = tbl$razon_social[rev(order(tbl$VPN))])
max<-max(tbl$VPN, na.rm=T)+1500000
min<-min(tbl$VPN, na.rm=T)-1000000
point <- format_format(big.mark = ".", decimal.mark = ",", scientific = FALSE)
options(scipen=1000)
p<-ggplot(data=tbl, aes(x=Company, y=VPN, fill = Company)) +
geom_bar(stat="identity") +
#geom_text(aes(label=VPE_mensual, vjust=-0.8)) +
scale_fill_manual(values= rev(colorRampPalette(brewer.pal(11, "RdYlGn"))(n))) +
theme(legend.position="") +
scale_y_continuous(labels=function(x) format(x, big.mark = ".",decimal.mark=",",
scientific = FALSE)#,
#                    sec.axis = sec_axis(~./240, name = "Pensión Mensual (pesos)", labels=function(x) format(x, big.mark = ".", decimal.mark = ",", scientific = FALSE))
)+
ylab("Total Valor Económico Pensión")  + xlab("")  +
theme(axis.text.y=element_text(size=rel(1.4) , angle=90),
axis.title.y=element_text(size=rel(1.8) ),
axis.text.x=element_text(size=rel(1.4), angle=90),
panel.grid.major.x = element_blank(),
panel.grid.major.y = element_line(colour = "Grey30", linetype = "dashed"))+
geom_text(aes(label = paste0("$",point(val_pesos_pension_bru)) , angle=90, size = 2, vjust = 0.4, hjust= -0.1)) +
coord_cartesian(ylim=c(min,max))  #coord_flip() +
return(ggsave(paste0("Tratamientos/Treat4", id ,".png"), width=30, height = 25, units = "cm"))
}
fcn.control("F", "nivel2", "1a", "co_1a_rp" )
fcn.control("F", "nivel2", "3a", "co_1a_rp" )
fcn.control("F", "nivel2", "3a", "co_3a_rp" )
fcn.control("F", "nivel2", "3a", "co_3a_rp" )
fcn.treat1("F", "nivel2", "1a", "co_1a_rp" )
fcn.treat2("F", "nivel2", "1a", "co_1a_rp" )
fcn.treat3("F", "nivel2", "1a", "co_1a_rp" )
fcn.treat4("M", "nivel4", "2a", "co_2a3a" )
fcn.treat4("F", "nivel1", "3a", "co_3a3b" )
fcn.treat1("F", "nivel2", "1a", "co_1a_rp" )
rm(list = ls())
###########################################
### Creando un sólo DF con todas los datos
###########################################
## Leer nombre de archivos
perfil.files <- list.files("./CSV/", recursive = T, pattern = 'co_.+csv', full.names = T)
##Leer Columnas
all.files <- NULL
for(bf in perfil.files){
temp <- read.csv2(bf, as.is = T)
valid_col <- ncol(temp)-3
for(i in 1:valid_col)temp[ , i] <- gsub("\\s","", temp[, i])
df <- sub(".+/CSV/", "\\1", bf)
df<-file_path_sans_ext(df)
temp$pid <- df
all.files <- rbind.fill(all.files, temp)
}
table(table(all.files$perfil))
unique(all.files$perfil)
all.files$perfil2<-substr(all.files$perfil, start = 1, stop = 2)
unique(all.files$perfil2)
##Agrego ID Unico = Grupo + Perfil
all.files$id <- paste0( all.files$grupo,".", all.files$perfil2,".", all.files$pid)
##Cambio ID a variable Categorica, para hacer pruebas
all.files$nid<-as.numeric(all.files$id)
table(all.files$nid)
## Transformación de pensión en pesos (valor UF 27.161,48 01/07/2018)
all.files$val_uf_pension_bru<-as.numeric(all.files$val_uf_pension_bru) #make numeric
all.files$val_pesos_pension_bru<-all.files$val_uf_pension_bru*27161.48
## Genero nuevo archivo con los cambios
write.table(all.files, "nuevaBD.csv", sep = ";", quote = F, row.names = T)
#################### End merge #####################################
View(all.files)
rm(list = ls())
###########################################
### Creando un sólo DF con todas los datos
###########################################
## Leer nombre de archivos
perfil.files <- list.files("./CSV/", recursive = T, pattern = 'co_.+csv', full.names = T)
##Leer Columnas
all.files <- NULL
for(bf in perfil.files){
temp <- read.csv2(bf, as.is = T)
valid_col <- ncol(temp)-3
for(i in 1:valid_col)temp[ , i] <- gsub("\\s","", temp[, i])
df <- sub(".+/CSV/", "\\1", bf)
df<-file_path_sans_ext(df)
temp$pid <- df
all.files <- rbind.fill(all.files, temp)
}
table(table(all.files$perfil))
unique(all.files$perfil)
all.files$perfil2<-substr(all.files$perfil, start = 1, stop = 2)
unique(all.files$perfil2)
##Agrego ID Unico = Grupo + Perfil
all.files$id <- paste0( all.files$grupo,".", all.files$perfil2,".", all.files$pid)
##Cambio ID a variable Categorica, para hacer pruebas
all.files$nid<-as.numeric(all.files$id)
table(all.files$nid)
## Transformación de pensión en pesos (valor UF 27.161,48 01/07/2018)
all.files$val_uf_pension_bru<-as.numeric(all.files$val_uf_pension_bru) #make numeric
all.files$val_pesos_pension_bru<-all.files$val_uf_pension_bru*27161.48
all.files$id <- paste0( all.files$grupo,".", all.files$perfil2,".", all.files$pid)
all.files$nid<-as.numeric(all.files$id)
all.files$nid<-as.numeric(as.charactr(all.files$id))
all.files$nid<-as.numeric(as.character(all.files$id))
class(all.files$id)
as.numeric(as.character(all.files$id))
summary(all.files$id)
table(all.files$id)
as.numeric(all.files$id)
all.files$id <- paste0( all.files$grupo,".", all.files$perfil,".", all.files$pid)
all.files$nid<-as.numeric(all.files$id)
all.files$id <- cbind(id = paste0( all.files$grupo,".", all.files$perfil2,".", all.files$pid),all.files )
##Cambio ID a variable Categorica, para hacer pruebas
all.files$nid<-as.numeric(all.files$id)
all.files$nid<-as.numeric(all.files$id)
rm(list = ls())
###########################################
### Creando un sólo DF con todas los datos
###########################################
## Leer nombre de archivos
perfil.files <- list.files("./CSV/", recursive = T, pattern = 'co_.+csv', full.names = T)
##Leer Columnas
all.files <- NULL
for(bf in perfil.files){
temp <- read.csv2(bf, as.is = T)
valid_col <- ncol(temp)-3
for(i in 1:valid_col)temp[ , i] <- gsub("\\s","", temp[, i])
df <- sub(".+/CSV/", "\\1", bf)
df<-file_path_sans_ext(df)
temp$pid <- df
all.files <- rbind.fill(all.files, temp)
}
table(table(all.files$perfil))
unique(all.files$perfil)
all.files$perfil2<-substr(all.files$perfil, start = 1, stop = 2)
unique(all.files$perfil2)
##Agrego ID Unico = Grupo + Perfil
all.files$id <- cbind(id = paste0( all.files$grupo,".", all.files$perfil2,".", all.files$pid),all.files )
##Cambio ID a variable Categorica, para hacer pruebas
all.files$nid<-as.numeric(all.files$id)
all.files <- cbind(id = paste0( all.files$grupo,".", all.files$perfil2,".", all.files$pid),all.files )
##Cambio ID a variable Categorica, para hacer pruebas
all.files$nid<-as.numeric(all.files$id)
#setwd("C:/Users/Mauro/Desktop/SP_excel")#################################
setwd("~/GitHub/Experimento-Metricas-y-Formatos-SCOMP/Excel_SP")
rm(list = ls())
###########################################
### Creando un sólo DF con todas los datos
###########################################
## Leer nombre de archivos
perfil.files <- list.files("./CSV/", recursive = T, pattern = 'co_.+csv', full.names = T)
##Leer Columnas
all.files <- NULL
for(bf in perfil.files){
temp <- read.csv2(bf, as.is = T)
valid_col <- ncol(temp)-3
for(i in 1:valid_col)temp[ , i] <- gsub("\\s","", temp[, i])
df <- sub(".+/CSV/", "\\1", bf)
df<-file_path_sans_ext(df)
temp$pid <- df
all.files <- rbind.fill(all.files, temp)
}
table(table(all.files$perfil))
unique(all.files$perfil2)
all.files$perfil2<-substr(all.files$perfil, start = 1, stop = 2)
unique(all.files$perfil2)
##Agrego ID Unico = Grupo + Perfil
all.files <- cbind(id = paste0( all.files$grupo,".", all.files$perfil2,".", all.files$pid),all.files )
##Cambio ID a variable Categorica, para hacer pruebas
all.files$nid<-as.numeric(all.files$id)
table(all.files$nid)
## Transformación de pensión en pesos (valor UF 27.161,48 01/07/2018)
all.files$val_uf_pension_bru<-as.numeric(all.files$val_uf_pension_bru) #make numeric
all.files$val_pesos_pension_bru<-all.files$val_uf_pension_bru*27161.48
## Genero nuevo archivo con los cambios
write.table(all.files, "nuevaBD.csv", sep = ";", quote = F, row.names = T)
fcn.control <- function(gender, econ, mode, pair){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "val_uf_pension_bru", "riesgo")]
names(tbl)<-c( "Razón Social", "Valor Pensión UF", "Clasificación de Riesgo")
tbl<-xtable(tbl, caption="Leyenda del Control" )
return(print(tbl, type="HTML", file=paste0("Tratamientos/control", id ,".html"), include.rownames=FALSE,
format.args=list(big.mark = ".", decimal.mark = ","))
)
}
##########################
### Function - Treatment 1
##########################
fcn.treat1 <- function(gender, econ, mode, pair){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "val_pesos_pension_bru", "riesgo")]
tbl$val_pesos_pension_bru<-round( tbl$val_pesos_pension_bru, 0)
names(tbl)<-c( "Razón Social", "Valor Pensión $", "Clasificación de Riesgo")
tbl<-xtable(tbl, caption="Leyenda del Tratamiento 1" )
digits(tbl) <- c(0,0,0,0)
return(print(tbl, type="HTML", file=paste0("Tratamientos/Treat1", id ,".html"), include.rownames=FALSE,
format.args=list(big.mark = ".", decimal.mark = ","))
)
}
##########################
### Function - Treatment 2
##########################
fcn.treat2 <- function(gender, econ, mode, pair){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "val_pesos_pension_bru", "VPN")]
tbl$val_pesos_pension_bru<-round( tbl$val_pesos_pension_bru, 0)
names(tbl)<-c( "Razón Social", "Valor Pensión $",  "Total VPN Pensión")
tbl<-xtable(tbl, caption="Leyenda del Tratamiento 2" )
digits(tbl) <- c(0,0,0,0)
return(print(tbl, type="HTML", file=paste0("Tratamientos/Treat2", id ,".html"), include.rownames=FALSE,
format.args=list(big.mark = ".", decimal.mark = ","))
)
}
##########################
### Function - Treatment 3
##########################
fcn.treat3 <- function(gender, econ, mode, pair){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "val_pesos_pension_bru", "VPN")]
tbl$VPNDiff<- tbl$VPN - max(tbl$VPN)
tbl$val_pesos_pension_bru<-round( tbl$val_pesos_pension_bru, 0)
tbl$VPNDiff<-round( tbl$VPNDiff, 0)
names(tbl)<-c( "Razón Social", "Valor Pensión $",  "Total VPN Pensión", "VPN dif")
tbl<-xtable(tbl, caption="Leyenda del Tratamiento 3" )
digits(tbl) <- c(0,0,0,0,0)
return(print(tbl, type="HTML", file=paste0("Tratamientos/Treat3", id ,".html"), include.rownames=FALSE,
format.args=list(big.mark = ".", decimal.mark = ","))
)
}
##########################
### Function - Treatment 4 // Simulation code, this still needs to be adjusted and tested using real data
##########################
fcn.treat4 <- function(gender, econ, mode, pair){
id<-paste0(gender, econ, ".", mode, ".", pair)
tbl<-all.files[all.files$id==id, c("razon_social", "val_pesos_pension_bru", "VPN")]
tbl$val_pesos_pension_bru<-round( tbl$val_pesos_pension_bru, 0)
n<-nrow(tbl)
tbl$Company <- factor(tbl$razon_social, levels = tbl$razon_social[rev(order(tbl$VPN))])
max<-max(tbl$VPN, na.rm=T)+1500000
min<-min(tbl$VPN, na.rm=T)-1000000
point <- format_format(big.mark = ".", decimal.mark = ",", scientific = FALSE)
options(scipen=1000)
p<-ggplot(data=tbl, aes(x=Company, y=VPN, fill = Company)) +
geom_bar(stat="identity") +
#geom_text(aes(label=VPE_mensual, vjust=-0.8)) +
scale_fill_manual(values= rev(colorRampPalette(brewer.pal(11, "RdYlGn"))(n))) +
theme(legend.position="") +
scale_y_continuous(labels=function(x) format(x, big.mark = ".",decimal.mark=",",
scientific = FALSE)#,
#                    sec.axis = sec_axis(~./240, name = "Pensión Mensual (pesos)", labels=function(x) format(x, big.mark = ".", decimal.mark = ",", scientific = FALSE))
)+
ylab("Total Valor Económico Pensión")  + xlab("")  +
theme(axis.text.y=element_text(size=rel(1.4) , angle=90),
axis.title.y=element_text(size=rel(1.8) ),
axis.text.x=element_text(size=rel(1.4), angle=90),
panel.grid.major.x = element_blank(),
panel.grid.major.y = element_line(colour = "Grey30", linetype = "dashed"))+
geom_text(aes(label = paste0("$",point(val_pesos_pension_bru)) , angle=90, size = 2, vjust = 0.4, hjust= -0.1)) +
coord_cartesian(ylim=c(min,max))  #coord_flip() +
return(ggsave(paste0("Tratamientos/Treat4", id ,".png"), width=30, height = 25, units = "cm"))
}
fcn.treat1("F", "nivel2", "1a", "co_1a_rp" )
fcn.treat2("F", "nivel2", "1a", "co_1a_rp" )
fcn.treat3("F", "nivel2", "1a", "co_1a_rp" )
all.files$VPN<-all.files$val_pesos_pension_bru*12*20
fcn.treat2("F", "nivel2", "1a", "co_1a_rp" )
fcn.treat3("F", "nivel2", "1a", "co_1a_rp" )
fcn.treat3("F", "nivel2", "1a", "co_1a_rp" )
fcn.treat3("F", "nivel2", "1a", "co_1a_rp" )
fcn.treat4("M", "nivel4", "2a", "co_2a3a" )
fcn.treat4("F", "nivel1", "3a", "co_3a3b" )
library(ggplot2)
install.packages("ggplot2")
library(ggplot2)
fcn.treat4("M", "nivel4", "2a", "co_2a3a" )
fcn.treat4("F", "nivel1", "3a", "co_3a3b" )
modepg<-paste0(mode1,pg)
gender<-"F"
income<-"nivel2"
mode1<- "1"
mode2<- "3"
pg<-"b"
modepg<-paste0(mode1,pg)
gender<-"F"
income<-"nivel2"
mode1<- "1"
mode2<- "3"
pg<-"b"
mode1pg<-paste0(mode1,pg)
mode2pg<-paste0(mode2,pg)
match<-paste0("co_", mode1pg, mode2pg)
fcn.treat3(gender, income, modepg, match)
